// ⏱️ 1. delay 함수 정의
function delay(ms) {
return new Promise(resolve => setTimeout(resolve, ms));
}

// 📍 2. 비동기로 순차 fetch 실행
(async () => {
for (let i = 0; i < courses.length; i++) {
const course = courses[i];
try {
const res = await fetch(`assets/json/${course.name}_path.json`);
const data = await res.json();
const path = data.map(c => new kakao.maps.LatLng(c[0], c[1]));

// 원래 선
const polyline = new kakao.maps.Polyline({
path: path,
strokeWeight: 4,
strokeColor: course.color,
strokeOpacity: 0.8,
strokeStyle: 'solid'
});
polyline.setMap(map);

// 터치 영역용 투명 선
const hitLine = new kakao.maps.Polyline({
path: path,
strokeWeight: 20,
strokeColor: 'transparent',
strokeOpacity: 0
});
hitLine.setMap(map);

kakao.maps.event.addListener(hitLine, 'click', function () {
if (window.CourseChannel) {
window.CourseChannel.postMessage(course.name);
}
});

// 라벨
const midIndex = Math.floor(path.length / 2);
const labelPos = path[midIndex];
const labelHTML = `
<div onclick="window.CourseChannel?.postMessage('${course.name}')"
     style="
              cursor: pointer;
              padding: 6px 10px;
              background: white;
              border: 2px solid ${course.color};
              color: ${course.color};
              font-weight: bold;
              border-radius: 8px;
              box-shadow: 0px 2px 4px rgba(0,0,0,0.2);
              white-space: nowrap;">
    ${course.label}
</div>`;
const overlay = new kakao.maps.CustomOverlay({
position: labelPos,
content: labelHTML,
yAnchor: 1
});
overlay.setMap(map);
} catch (err) {
console.error(`❌ ${course.name} 경로 불러오기 실패`, err);
}

// ⏱️ 딜레이 추가 (300ms)
await delay(300);
}
})();
