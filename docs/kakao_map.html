<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>í•œì–‘ë„ì„± ì „ì²´ ì½”ìŠ¤</title>
    <style>
        html, body, #map {
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
        }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    const script = document.createElement('script');
    script.src = "https://dapi.kakao.com/v2/maps/sdk.js?appkey=8d8465643b5de1002ccbe7b3197fd029&autoload=false";
    script.onload = function () {
      kakao.maps.load(function () {
        const container = document.getElementById('map');
        const options = {
          center: new kakao.maps.LatLng(37.5878, 127.0040),
          level: 5
        };
        const map = new kakao.maps.Map(container, options);

        const courses = [
          { name: "baegak", label: "1ì½”ìŠ¤ ë°±ì•…êµ¬ê°„", color: "#5B3A29" },
          { name: "naksan", label: "2ì½”ìŠ¤ ë‚™ì‚°êµ¬ê°„", color: "#007bff" },
          { name: "heunginjimun", label: "3ì½”ìŠ¤ í¥ì¸ì§€ë¬¸êµ¬ê°„", color: "#00b894" },
          { name: "namsan", label: "4ì½”ìŠ¤ ë‚¨ì‚°êµ¬ê°„", color: "#e74c3c" },
          { name: "sungnyemun", label: "5ì½”ìŠ¤ ìˆ­ë¡€ë¬¸êµ¬ê°„", color: "#f39c12" },
          { name: "inwangsan", label: "6ì½”ìŠ¤ ì¸ì™•ì‚°êµ¬ê°„", color: "#8e44ad" }
        ];

        courses.forEach(course => {
          fetch(`assets/json/${course.name}_path.json`)
            .then(res => res.json())
            .then(data => {
              const path = data.map(c => new kakao.maps.LatLng(c[0], c[1]));

              // âš¡ ì–‡ì€ ì‹œê°ìš© í´ë¦¬ë¼ì¸
              const polyline = new kakao.maps.Polyline({
                path: path,
                strokeWeight: 4,
                strokeColor: course.color,
                strokeOpacity: 0.8,
                strokeStyle: 'solid'
              });
              polyline.setMap(map);

              // âœ… í´ë¦­ íŒì •ìš© êµµì€ íˆ¬ëª… í´ë¦¬ë¼ì¸ (ì•½ê°„ ë¶ˆíˆ¬ëª… ì²˜ë¦¬)
              const hitLine = new kakao.maps.Polyline({
                path: path,
                strokeWeight: 20,
                strokeColor: 'transparent',
                strokeOpacity: 0.01 // ì™„ì „ íˆ¬ëª…ë³´ë‹¤ ì´ë²¤íŠ¸ ì¸ì‹ ì•ˆì •ì 
              });
              hitLine.setMap(map);

              // âœ… í´ë¦­ ì´ë²¤íŠ¸ - ì–‡ì€ ì„ 
              kakao.maps.event.addListener(polyline, 'click', function () {
                console.log("ğŸ“Œ polyline clicked:", course.name);
                if (window.CourseChannel) {
                  window.CourseChannel.postMessage(course.name);
                }
              });

              // âœ… í´ë¦­ ì´ë²¤íŠ¸ - í„°ì¹˜ íŒì •ìš© ì„ 
              kakao.maps.event.addListener(hitLine, 'click', function () {
                console.log("ğŸ“Œ hitLine clicked:", course.name);
                if (window.CourseChannel) {
                  window.CourseChannel.postMessage(course.name);
                }
              });

              // âœ… ì¤‘ê°„ ë¼ë²¨ ì˜¤ë²„ë ˆì´ (í´ë¦­ ê°€ëŠ¥)
              const midIndex = Math.floor(path.length / 2);
              const labelPos = path[midIndex];
              const labelHTML = `
                <div onclick="window.CourseChannel?.postMessage('${course.name}')"
                     style="
                      cursor: pointer;
                      padding: 6px 10px;
                      background: white;
                      border: 2px solid ${course.color};
                      color: ${course.color};
                      font-weight: bold;
                      border-radius: 8px;
                      box-shadow: 0px 2px 4px rgba(0,0,0,0.2);
                      white-space: nowrap;">
                  ${course.label}
                </div>`;
              const overlay = new kakao.maps.CustomOverlay({
                position: labelPos,
                content: labelHTML,
                yAnchor: 1
              });
              overlay.setMap(map);
            });
        });
      });
    };
    document.head.appendChild(script);
</script>
</body>
</html>
