// â±ï¸ 1. delay í•¨ìˆ˜ ì •ì˜
function delay(ms) {
return new Promise(resolve => setTimeout(resolve, ms));
}

// ğŸ“ 2. ë¹„ë™ê¸°ë¡œ ìˆœì°¨ fetch ì‹¤í–‰
(async () => {
for (let i = 0; i < courses.length; i++) {
const course = courses[i];
try {
const res = await fetch(`assets/json/${course.name}_path.json`);
const data = await res.json();
const path = data.map(c => new kakao.maps.LatLng(c[0], c[1]));

// ì›ë˜ ì„ 
const polyline = new kakao.maps.Polyline({
path: path,
strokeWeight: 4,
strokeColor: course.color,
strokeOpacity: 0.8,
strokeStyle: 'solid'
});
polyline.setMap(map);

// í„°ì¹˜ ì˜ì—­ìš© íˆ¬ëª… ì„ 
const hitLine = new kakao.maps.Polyline({
path: path,
strokeWeight: 20,
strokeColor: 'transparent',
strokeOpacity: 0
});
hitLine.setMap(map);

kakao.maps.event.addListener(hitLine, 'click', function () {
if (window.CourseChannel) {
window.CourseChannel.postMessage(course.name);
}
});

// ë¼ë²¨
const midIndex = Math.floor(path.length / 2);
const labelPos = path[midIndex];
const labelHTML = `
<div onclick="window.CourseChannel?.postMessage('${course.name}')"
     style="
              cursor: pointer;
              padding: 6px 10px;
              background: white;
              border: 2px solid ${course.color};
              color: ${course.color};
              font-weight: bold;
              border-radius: 8px;
              box-shadow: 0px 2px 4px rgba(0,0,0,0.2);
              white-space: nowrap;">
    ${course.label}
</div>`;
const overlay = new kakao.maps.CustomOverlay({
position: labelPos,
content: labelHTML,
yAnchor: 1
});
overlay.setMap(map);
} catch (err) {
console.error(`âŒ ${course.name} ê²½ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨`, err);
}

// â±ï¸ ë”œë ˆì´ ì¶”ê°€ (300ms)
await delay(300);
}
})();
