<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>코스 추적 지도</title>
    <style>
        html, body, #map {
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
        }
    </style>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8d8465643b5de1002ccbe7b3197fd029&autoload=false"></script>
</head>
<body>
<div id="map"></div>
<script>
    let map = null;
    let userMarker = null;
    window.flutter_ready = false;

    kakao.maps.load(function () {
      const container = document.getElementById('map');
      const center = new kakao.maps.LatLng(37.5665, 126.9780);
      map = new kakao.maps.Map(container, {
        center: center,
        level: 5
      });
      window.flutter_ready = true;
    });

    function drawPolyline(pathPoints) {
      if (!window.flutter_ready || !map) return;
      const latlngs = pathPoints.map(p => new kakao.maps.LatLng(p.lat, p.lng));
      const polyline = new kakao.maps.Polyline({
        path: latlngs,
        strokeWeight: 6,
        strokeColor: '#FF6600',
        strokeOpacity: 0.8,
        strokeStyle: 'solid'
      });
      polyline.setMap(map);
      map.setCenter(latlngs[0]);
    }

    function addStampMarkers(stamps) {
      if (!window.flutter_ready || !map) return;
      stamps.forEach(stamp => {
        new kakao.maps.Marker({
          position: new kakao.maps.LatLng(stamp.lat, stamp.lng),
          map: map,
          title: stamp.name
        });
      });
    }

    function updateUserLocation(lat, lng) {
      if (!window.flutter_ready || !map) return;
      const position = new kakao.maps.LatLng(lat, lng);
      if (userMarker) userMarker.setMap(null);
      userMarker = new kakao.maps.Marker({
        position: position,
        map: map,
        title: '현재 위치',
        image: new kakao.maps.MarkerImage(
          "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
          new kakao.maps.Size(24, 35)
        )
      });
      map.setCenter(position);
    }
</script>
</body>
</html>
